<!DOCTYPE html>
<html lang="en">
<head>
	<base target="_top">
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<title>Map Test</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>

	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		.leaflet-container {
			height: 400px;
			width: 600px;
			max-width: 100%;
			max-height: 100%;
		}
	</style>


	
</head>
<body>

  <div id="map" style="width: 1024px; height: 768px;"></div>
    <script src="https://unpkg.com/protomaps@1.23.0/dist/protomaps.min.js"></script>

	<script type="module">
		// This could be imported from colors.js with:
		// import { inferno } from "./js/colors.js";


export class Colormap {
    constructor(colors) {
        this.colors = colors
    }

    get_color(x) {
        var n = this.colors.length

        var ii = Math.round(x * (n - 1))
        var color = this.colors[ii]

        return color
    }
}

var hot = new Colormap([
  "rgb(10 0 0)",
  "rgb(13 0 0)",
  "rgb(15 0 0)",
  "rgb(18 0 0)",
  "rgb(21 0 0)",
  "rgb(23 0 0)",
  "rgb(26 0 0)",
  "rgb(28 0 0)",
  "rgb(31 0 0)",
  "rgb(34 0 0)",
  "rgb(36 0 0)",
  "rgb(39 0 0)",
  "rgb(42 0 0)",
  "rgb(44 0 0)",
  "rgb(47 0 0)",
  "rgb(49 0 0)",
  "rgb(52 0 0)",
  "rgb(55 0 0)",
  "rgb(57 0 0)",
  "rgb(60 0 0)",
  "rgb(63 0 0)",
  "rgb(65 0 0)",
  "rgb(68 0 0)",
  "rgb(70 0 0)",
  "rgb(73 0 0)",
  "rgb(76 0 0)",
  "rgb(78 0 0)",
  "rgb(81 0 0)",
  "rgb(84 0 0)",
  "rgb(86 0 0)",
  "rgb(89 0 0)",
  "rgb(91 0 0)",
  "rgb(94 0 0)",
  "rgb(97 0 0)",
  "rgb(99 0 0)",
  "rgb(102 0 0)",
  "rgb(105 0 0)",
  "rgb(107 0 0)",
  "rgb(110 0 0)",
  "rgb(112 0 0)",
  "rgb(115 0 0)",
  "rgb(118 0 0)",
  "rgb(120 0 0)",
  "rgb(123 0 0)",
  "rgb(126 0 0)",
  "rgb(128 0 0)",
  "rgb(131 0 0)",
  "rgb(133 0 0)",
  "rgb(136 0 0)",
  "rgb(139 0 0)",
  "rgb(141 0 0)",
  "rgb(144 0 0)",
  "rgb(147 0 0)",
  "rgb(149 0 0)",
  "rgb(152 0 0)",
  "rgb(154 0 0)",
  "rgb(157 0 0)",
  "rgb(160 0 0)",
  "rgb(162 0 0)",
  "rgb(165 0 0)",
  "rgb(168 0 0)",
  "rgb(170 0 0)",
  "rgb(173 0 0)",
  "rgb(175 0 0)",
  "rgb(178 0 0)",
  "rgb(181 0 0)",
  "rgb(183 0 0)",
  "rgb(186 0 0)",
  "rgb(189 0 0)",
  "rgb(191 0 0)",
  "rgb(194 0 0)",
  "rgb(196 0 0)",
  "rgb(199 0 0)",
  "rgb(202 0 0)",
  "rgb(204 0 0)",
  "rgb(207 0 0)",
  "rgb(210 0 0)",
  "rgb(212 0 0)",
  "rgb(215 0 0)",
  "rgb(217 0 0)",
  "rgb(220 0 0)",
  "rgb(223 0 0)",
  "rgb(225 0 0)",
  "rgb(228 0 0)",
  "rgb(231 0 0)",
  "rgb(233 0 0)",
  "rgb(236 0 0)",
  "rgb(238 0 0)",
  "rgb(241 0 0)",
  "rgb(244 0 0)",
  "rgb(246 0 0)",
  "rgb(249 0 0)",
  "rgb(252 0 0)",
  "rgb(254 0 0)",
  "rgb(255 2 0)",
  "rgb(255 5 0)",
  "rgb(255 7 0)",
  "rgb(255 10 0)",
  "rgb(255 12 0)",
  "rgb(255 15 0)",
  "rgb(255 18 0)",
  "rgb(255 20 0)",
  "rgb(255 23 0)",
  "rgb(255 26 0)",
  "rgb(255 28 0)",
  "rgb(255 31 0)",
  "rgb(255 33 0)",
  "rgb(255 36 0)",
  "rgb(255 39 0)",
  "rgb(255 41 0)",
  "rgb(255 44 0)",
  "rgb(255 47 0)",
  "rgb(255 49 0)",
  "rgb(255 52 0)",
  "rgb(255 54 0)",
  "rgb(255 57 0)",
  "rgb(255 60 0)",
  "rgb(255 62 0)",
  "rgb(255 65 0)",
  "rgb(255 68 0)",
  "rgb(255 70 0)",
  "rgb(255 73 0)",
  "rgb(255 75 0)",
  "rgb(255 78 0)",
  "rgb(255 81 0)",
  "rgb(255 83 0)",
  "rgb(255 86 0)",
  "rgb(255 91 0)",
  "rgb(255 94 0)",
  "rgb(255 96 0)",
  "rgb(255 99 0)",
  "rgb(255 102 0)",
  "rgb(255 104 0)",
  "rgb(255 107 0)",
  "rgb(255 110 0)",
  "rgb(255 112 0)",
  "rgb(255 115 0)",
  "rgb(255 117 0)",
  "rgb(255 120 0)",
  "rgb(255 123 0)",
  "rgb(255 125 0)",
  "rgb(255 128 0)",
  "rgb(255 131 0)",
  "rgb(255 133 0)",
  "rgb(255 136 0)",
  "rgb(255 138 0)",
  "rgb(255 141 0)",
  "rgb(255 144 0)",
  "rgb(255 146 0)",
  "rgb(255 149 0)",
  "rgb(255 151 0)",
  "rgb(255 154 0)",
  "rgb(255 157 0)",
  "rgb(255 159 0)",
  "rgb(255 162 0)",
  "rgb(255 165 0)",
  "rgb(255 167 0)",
  "rgb(255 170 0)",
  "rgb(255 172 0)",
  "rgb(255 175 0)",
  "rgb(255 178 0)",
  "rgb(255 180 0)",
  "rgb(255 183 0)",
  "rgb(255 186 0)",
  "rgb(255 188 0)",
  "rgb(255 191 0)",
  "rgb(255 193 0)",
  "rgb(255 196 0)",
  "rgb(255 199 0)",
  "rgb(255 201 0)",
  "rgb(255 204 0)",
  "rgb(255 207 0)",
  "rgb(255 209 0)",
  "rgb(255 212 0)",
  "rgb(255 214 0)",
  "rgb(255 217 0)",
  "rgb(255 220 0)",
  "rgb(255 222 0)",
  "rgb(255 225 0)",
  "rgb(255 228 0)",
  "rgb(255 230 0)",
  "rgb(255 233 0)",
  "rgb(255 235 0)",
  "rgb(255 238 0)",
  "rgb(255 241 0)",
  "rgb(255 243 0)",
  "rgb(255 246 0)",
  "rgb(255 249 0)",
  "rgb(255 251 0)",
  "rgb(255 254 0)",
  "rgb(255 255 2)",
  "rgb(255 255 6)",
  "rgb(255 255 10)",
  "rgb(255 255 14)",
  "rgb(255 255 18)",
  "rgb(255 255 22)",
  "rgb(255 255 26)",
  "rgb(255 255 30)",
  "rgb(255 255 34)",
  "rgb(255 255 38)",
  "rgb(255 255 42)",
  "rgb(255 255 46)",
  "rgb(255 255 50)",
  "rgb(255 255 54)",
  "rgb(255 255 58)",
  "rgb(255 255 62)",
  "rgb(255 255 65)",
  "rgb(255 255 69)",
  "rgb(255 255 73)",
  "rgb(255 255 77)",
  "rgb(255 255 81)",
  "rgb(255 255 85)",
  "rgb(255 255 89)",
  "rgb(255 255 93)",
  "rgb(255 255 97)",
  "rgb(255 255 101)",
  "rgb(255 255 105)",
  "rgb(255 255 109)",
  "rgb(255 255 113)",
  "rgb(255 255 117)",
  "rgb(255 255 121)",
  "rgb(255 255 125)",
  "rgb(255 255 128)",
  "rgb(255 255 132)",
  "rgb(255 255 136)",
  "rgb(255 255 140)",
  "rgb(255 255 144)",
  "rgb(255 255 148)",
  "rgb(255 255 152)",
  "rgb(255 255 156)",
  "rgb(255 255 160)",
  "rgb(255 255 164)",
  "rgb(255 255 168)",
  "rgb(255 255 172)",
  "rgb(255 255 176)",
  "rgb(255 255 180)",
  "rgb(255 255 184)",
  "rgb(255 255 188)",
  "rgb(255 255 191)",
  "rgb(255 255 195)",
  "rgb(255 255 199)",
  "rgb(255 255 203)",
  "rgb(255 255 207)",
  "rgb(255 255 211)",
  "rgb(255 255 215)",
  "rgb(255 255 219)",
  "rgb(255 255 223)",
  "rgb(255 255 227)",
  "rgb(255 255 231)",
  "rgb(255 255 235)",
  "rgb(255 255 239)",
  "rgb(255 255 243)",
  "rgb(255 255 247)",
  "rgb(255 255 251)",
  "rgb(255 255 255)",
])

		// END of colors.js

		const map = L.map('map').setView([39.8333, -98.5833], 4);

		// const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
		// 	maxZoom: 19,
		// 	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
		// }).addTo(map);

		const tile_layer = L.tileLayer('https://storage.googleapis.com/vengroff-map-test/rastertiles/{z}/{x}/{y}.png', {
			minZoom: 3,
			maxZoom: 8,
		})

		let STATE_PAINT_RULES = [
			{
				dataLayer:"states-2020",
				symbolizer:new protomaps.PolygonSymbolizer({
					fill: "transparent",
					stroke: "rgb(127 127 127)",
					width: 5
				})
			}
		];

		let STATE_LABEL_RULES = []; // ignore for now

		var state_layer = protomaps.leafletLayer({
			url:'https://storage.googleapis.com/vengroff-map-test/states-2020.pmtiles',
			paint_rules:STATE_PAINT_RULES,
			label_rules:STATE_LABEL_RULES
		})

 		function tract_fill(z, f) {
 			return hot.get_color(f.props.diversity);
 		}

		let TRACT_PAINT_RULES = [
			{
				dataLayer:"tracts-2020",
				symbolizer:new protomaps.PolygonSymbolizer({
					fill: tract_fill,
					stroke: "rgb(192 192 192)",
					width: 0.5
				})
			}
		];

		let TRACT_LABEL_RULES = []; // ignore for now

		var tract_layer = protomaps.leafletLayer({
			url:'https://storage.googleapis.com/vengroff-map-test/tracts-2020.pmtiles',
			paint_rules:TRACT_PAINT_RULES,
			label_rules:TRACT_LABEL_RULES
		})

		let CITY_PAINT_RULES = [
			{
				dataLayer: "cities",
				symbolizer: new protomaps.CircleSymbolizer({
					radius: 5,
					fill: "rgb(127, 127, 255)"
				})
			}
		];

		let CITY_LABEL_RULES = [
			{
				dataLayer: "cities10",
				symbolizer: new protomaps.CenteredTextSymbolizer({
					label_props:["NAME"],
					fill: "white",
					width:2,
					stroke:"black",
					font: "600 16px sans-serif"
				})
			},
			{
				dataLayer: "cities9",
				symbolizer: new protomaps.CenteredTextSymbolizer({
					label_props:["NAME"],
					fill: "white",
					width:2,
					stroke:"black",
					font: "600 14px sans-serif"
				})
			},
			{
				dataLayer: "cities8",
				symbolizer: new protomaps.CenteredTextSymbolizer({
					label_props:["NAME"],
					fill: "white",
					width:2,
					stroke:"black",
					font: "400 13px sans-serif"
				})
			},
			{
				dataLayer: "cities7",
				symbolizer: new protomaps.CenteredTextSymbolizer({
					label_props:["NAME"],
					fill: "white",
					width:2,
					stroke:"black",
					font: "300 12px sans-serif"
				})
			},
			{
				dataLayer: "cities6",
				symbolizer: new protomaps.CenteredTextSymbolizer({
					label_props:["NAME"],
					fill: "white",
					width:1,
					stroke:"black",
					font: "200 11px sans-serif"
				})
			},
		];

		var city_layer = protomaps.leafletLayer({
			url:'https://storage.googleapis.com/vengroff-map-test/cities.pmtiles',
			paint_rules:CITY_PAINT_RULES,
			label_rules:CITY_LABEL_RULES
		})

		tile_layer.addTo(map);

		tract_layer.addTo(map)
		state_layer.addTo(map)
		city_layer.addTo(map)

		map.options.minZoom = 3;
		map.options.maxZoom = 13;

		// var layer = protomaps.leafletLayer({url:'./states-2020.pmtiles'})
		// layer.addTo(map)
	</script>

</body>
</html>
